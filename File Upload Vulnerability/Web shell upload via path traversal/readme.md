## Lab Description: Web shell upload via path traversal

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/b6ae7ad6-59a5-4904-af5a-962719e5fa07)

## Solution: 
Preventing file execution in user-accessible directories
While it's clearly better to prevent dangerous file types being uploaded in the first place, the second line of defense is to stop the server from executing any scripts that do slip through the net.

As a precaution, servers generally only run scripts whose MIME type they have been explicitly configured to execute. Otherwise, they may just return some kind of error message or, in some cases, serve the contents of the file as plain text instead:

Log in as wiener to access the page where we can upload avatars.

### Upload the malicious file -

When we upload file.php with the contents <?php echo file_get_contents('/home/carlos/secret'); ?>, it is successfully uploaded without any issues.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/d2302a07-8980-4359-83d4-63f4d4b16c06)

But when we try to access/run the file, we get nothing in response. It is plaintext. It means the directory in which the file is saved doensn't allow certain files to be executed(Permission issues etc..,).

So we have to save the file in some other directory which has executable permissions.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/380668a6-19d0-44e4-99ca-a28eaafd9f44)

We can save this file in another directory.

Case 1:

When we give filename=../virus.php , the response says it is successfully uploaded but if we try accessing the file at academy.com/files/avatars/../file.php or academy.com/files/file.php it still shows nothing.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/19e608fc-0597-4130-a5d8-b231cfa65161)

Maybe the server strips of the .. or / so it gets saved as ..file.php.

Case 2 -

Now to bypass this we can try giving the name of the filename in the filename= parameter by Url encoding it as `filename="%2e%2e%2fvirus.php"`

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/69dee2d6-5052-4060-912a-2cf7105f7316)

Retreive the secret -
Now we can retreive the secret by accessing the file at /files/virus.php 

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/f84174e0-9463-4c99-b36b-56ad701006d0)

Secret: `ZJwGKCWxeW1gLVJ8B6tQVl1RRFECHAup`

Submit the secret to solve the lab.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/e0b86971-0b74-4369-9f6c-56bb8da73c13)




