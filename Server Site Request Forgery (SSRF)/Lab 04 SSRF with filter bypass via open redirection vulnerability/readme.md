## Lab Description: SSRF with filter bypass via open redirection vulnerability

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/3866d3c6-bbd5-4425-98b7-136529414b67)


## Solution:  

If the API used to make the back-end HTTP request supports redirections, you can construct a URL that satisfies the filter and results in a redirected request to the desired back-end target.

Suppose the application contains an open redirection vulnerability in which the following URL:
```
/product/nextProduct?currentProductId=6&path=http://evil-user.net
returns a redirection to:
```
http://evil-user.net
You can leverage the open redirection vulnerability to bypass the URL filter, and exploit the SSRF vulnerability as follows:
```
POST /product/stock HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 118

stockApi=http://weliketoshop.net/product/nextProduct?currentProductId=6&path=http://192.168.0.68/admin
```
The application then requests the supplied URL, which triggers the open redirection. It follows the redirection, and makes a request to the internal URL of the attacker's choosing.


![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/d13b6f5e-64da-4d43-a462-0d4f380a5f86)


Finding a openredirect vuln -

In this lab, below the check-stock feature we have 2 new options which is Return to list & Next product. It is a good indication that there might be a redirection happening to some other page.

Clicking on Next product , our browser sends a GET request as below

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/93203b12-64c7-46ba-9137-d6a87765d9f4)

We can see that there is a path= parameter which redirects to /product page.

Let's try to test if there is openredirect vulnerability in this path parameter by trying to access the backend server at http://192.168.0.12:8080.

Access the /admin panel of backend server

When we click check stock feature, a GET request is sent to /product/stock with a stockAPI parameter (stockApi=/product/stock/check?productId=2&storeId=1) in the body of the request.

Now provide the redirect path /product/nextProduct?path=http://192.168.0.12:8080/admin to the stockApi parameter(remove the currentProductId=1 from the full uri /product/nextProduct?currentProductId=1&path=/product?productId=2).

We get a 200 OK response & we can able to access the admin panel.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/6d27f452-4932-4e4f-8143-7038b521f6fd)


![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/a65c07a9-48df-45f2-aa89-b8592481cb97)

Lets delete the user carlos to solve the lab - /product/nextProduct?path=http://192.168.0.12:8080/admin/delete?username=carlos,

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/58748f78-6095-47c8-a8fb-45f774f3f53b)


![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/785f1be9-e720-4fb9-90e3-7d1128311ca9)

